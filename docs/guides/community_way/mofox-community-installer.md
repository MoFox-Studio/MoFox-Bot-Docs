# MoFox-Core安装脚本使用说明文档
### 小白快速通道喵，以下内容你可以不用查看
```bash
sudo curl -fsSL "https://raw.githubusercontent.com/MoFox-Elysia/MoFox-Installer/main/mofox.sh" -o "mofox.sh" && echo bash mofox.sh
```
## 脚本概述
- **脚本名称**: `mofox.sh`
- **版本**: 2.7.6
- **功能**: 在Armbian系统上自动安装MoFox-Core及相关软件
- **适用系统**: Debian 11 Armbian（理论支持所有主流Linux发行版）

## 脚本结构

### 主要功能模块
1. **系统检查与准备** - 检查系统资源、权限、架构和网络
2. **软件选择** - 交互式选择需要安装的软件
3. **软件安装** - 自动安装选择的软件包
4. **配置管理** - 配置MoFox-Core和NapcatQQ
5. **快速安装模式** - 检测到现有安装时的优化流程

---

## 函数功能详解

### 1. 核心工具函数

#### `retry_command()`
**功能**: 自动重试命令执行，最多重试指定次数
**参数**:
- `$1`: 最大重试次数
- `$2`: 重试延迟时间（秒）
- `$3`: 要执行的命令
- `$4`: 命令描述

#### `silent_install()`
**功能**: 静默执行命令，隐藏输出只显示结果
**参数**:
- `$1`: 要执行的命令
- `$2`: 命令描述

#### `print_message()`
**功能**: 打印带颜色的消息
**参数**:
- `$1`: 颜色代码
- `$2`: 消息内容

#### `print_header()`
**功能**: 打印章节标题
**参数**:
- `$1`: 标题文本

#### `print_mofox_ascii()`
**功能**: 显示MoFox ASCII艺术字

---

### 2. NapcatQQ配置函数组

#### `configure_napcat_token()`
**功能**: 修改Napcat的webui.json配置文件中的token
**用户交互**:
```bash
# 当脚本显示以下内容时：
正在检查Napcat配置文件...
当前token: xxxxxxxx

# 您可以选择：
是否要修改token？(y/N，直接回车跳过): 
# 输入 y 修改token，或按回车跳过
```

#### `run_napcat_in_screen()`
**功能**: 在screen会话中运行NapcatQQ
**输出信息**:
- 显示启动状态
- 提供查看screen会话的命令

#### `show_napcat_latest_log()`
**功能**: 显示Napcat的最新日志文件
**显示最后23行日志内容**

#### `check_napcat_login_status()`
**功能**: 检查NapcatQQ登录状态
**用户交互**:
```bash
# 脚本会显示日志并询问：
是否已登录完成？(Y/n，或输入 'r' 重新显示日志):

# 选项：
Y 或 回车 - 确认登录完成
n - 等待10秒后再次检查
r - 重新显示日志
```

#### `update_napcat_auto_login_account()`
**功能**: 从配置文件提取QQ号并更新autoLoginAccount
**自动执行**，无需用户输入

#### `configure_napcat_onebot()`
**功能**: 创建或更新onebot配置文件
**自动执行**，创建标准配置

#### `configure_napcat_complete()`
**功能**: NapcatQQ完整配置流程
**按步骤执行上述所有配置函数**

---

### 3. 安装目录检查函数

#### `check_mofox_directory()`
**功能**: 检查MoFox_Bot_Deployment文件夹是否存在
**用户交互**:
```bash
# 当检测到现有MoFox安装时，显示：
请选择操作：
1)删除现有 MoFox-Core 
2) 跳过系统检查，直接从软件选择开始
3) 正常完整安装
请选择 [1/2/3]: 
```

#### `check_napcat_directory()`
**功能**: 检查NapcatQQ文件夹是否存在
**用户交互**:
```bash
# 当检测到现有Napcat安装时，显示：
请选择NapcatQQ安装操作：
1) 跳过安装NapcatQQ
2) 正常安装 (忽略现有目录，可能覆盖)
请选择 [1/2]: 
```

---

### 4. 系统检查函数

#### `check_root()`
**功能**: 检查是否以root权限运行脚本
**如果未以root运行，脚本会报错退出**

#### `check_system_resources_strict()`
**功能**: 严格检查系统资源（存储空间和内存）
**要求**: 
- 8GB可用存储空间
- 1024MB可用内存
**不满足条件会退出安装**

#### `check_architecture()`
**功能**: 检查系统架构
**用户交互**（当检测到非ARM架构时）:
```bash
警告：检测到x86/x64架构，本脚本主要针对ARM架构优化
在x86系统上运行可能存在兼容性问题或功能限制
您希望继续安装吗？
1) 继续安装（自行承担兼容性风险）
2) 退出安装
请选择 [1/2]: 
```

---

### 5. 软件安装函数

#### `install_napcatqq()`
**功能**: 安装NapcatQQ
**流程**:
1. 下载安装脚本
2. 执行安装
3. 自动配置

#### `install_mofox()`
**功能**: 安装MoFox-Core（最复杂的安装流程）
**用户交互步骤**:

**步骤1**: 配置QQ账号和昵称
```bash
现在开始配置MoFox-Core的QQ账号和机器人信息
注意：QQ号应为纯数字，5-15位
请输入机器人的QQ号: 
请输入机器人的昵称（显示名称）: 
```

**步骤2**: 配置机器人别名
```bash
现在配置机器人别名（可设置多个，输入空值结束）
请输入一个别名（直接按Enter结束）: 
```

**步骤3**: 配置机器人人格设定
```bash
现在开始配置MoFox-Core的机器人人格设定
注意：这些设定将影响机器人的行为和回复风格

人格核心特质（建议50字以内，描述人格的核心特质）
请输入人格核心特质（例如：'是一个积极向上的女大学生'）: 

人格侧面特质（用一句话或几句话描述人格的一些侧面特质）
请输入人格侧面特质（例如：'喜欢帮助他人，热爱学习'）: 

身份特征（描述外貌、性别、身高、职业、属性等）
请输入身份特征（例如：'年龄为19岁,是女孩子,身高为160cm,有黑色的短发'）: 

背景故事（详细的世界观、背景故事、复杂人际关系等，可选）
注意：这部分内容将作为机器人的'背景知识'，不会频繁复述
请输入背景故事（直接按Enter跳过）: 

回复风格（描述机器人的表达风格和习惯）
请输入回复风格（例如：'回复可以简短一些。可以参考贴吧，知乎和微博的回复风格'）: 
```

**步骤4**: 配置聊天功能开关
```bash
现在开始配置MoFox-Core的聊天功能开关
以下配置将影响机器人的聊天行为和功能

是否允许回复自己说的话？
  如果开启，机器人可能会回复自己发送的消息
  默认值：否 (n)
允许回复自己？(y/n，默认n): 

是否开启私聊必然回复？
  如果开启，机器人在私聊中会必然回复每条消息
  默认值：否 (n)
私聊必然回复？(y/n，默认n): 

是否启用消息缓存系统？
  启用后，处理中收到的消息会被缓存，处理完成后统一刷新到未读列表
  可以提高消息处理效率，但可能增加内存使用
  默认值：否 (n)
启用消息缓存？(y/n，默认n): 

是否启用消息打断系统？
  启用后，机器人可以根据消息重要性打断当前处理流程
  默认值：否 (n)
启用消息打断？(y/n，默认n): 
```

**步骤5**: 配置主人QQ号
```bash
请输入主人QQ号: 
```

**步骤6**: 配置API Key（可选）
```bash
配置模型文件... ✓
请输入SiliconFlow的API Key（留空则保持默认）: 
```

---

### 6. 交互式选择函数

#### `select_software()`
**功能**: 选择要安装的软件
**用户交互**:
```bash
选择安装的软件
============================================

# 询问NapcatQQ安装（如果之前未选择）
是否安装 NapcatQQ？(y/N): 

# 询问1Panel安装（暂时无法使用）
是否安装 1panle？-暂时无法使用，请选择不安装(y/N): 

# 询问Cpolar安装
是否安装 coplar？(y/N): 
```

---

### 7. 安装流程控制函数

#### `quick_install_mode()`
**功能**: 快速安装模式（跳过系统检查）
**当检测到现有MoFox安装且用户选择"跳过系统检查"时触发**

#### `goto_installation_complete()`
**功能**: 显示安装完成总结信息
**显示**: 
- 总用时
- 安装的软件列表
- 使用说明
- 重启选项

---

## 完整的用户交互流程

### 启动脚本
```bash
sudo bash mofox.sh
```

### 步骤1: 欢迎界面
```
╔═══════════════════════════════════════╗
║                                       ║
║          ███╗   ███╗ ██████╗          ║
║          ████╗ ████║██╔═══██╗         ║
... (ASCII艺术字)
Armbian软件自动安装脚本 v2.7.6
============================================

# 显示安装模式选项
是否开始安装？(Y/n):
```
**输入**: `Y` 或直接回车继续，`n` 取消

### 步骤2: 目录检测
```
检查MoFox安装状态...
╔══════════════════════════════════════════════════════════╗
║                检测到现有MoFox安装                      ║
...
请选择操作：
1)删除现有 MoFox-Core 
2) 跳过系统检查，直接从软件选择开始
3) 正常完整安装
请选择 [1/2/3]: 
```
**输入**: `1`、`2` 或 `3`

### 步骤3: 系统检查（正常模式）
```
============================================
系统检查
============================================
检查存储空间 (最低 8GB)... ✓
检查可用内存 (最低 1024MB)... ✓
检查root权限... ✓
检查系统架构... ✓ (aarch64)
检查网络连接... ✓
```

### 步骤4: 软件选择
```
============================================
选择安装的软件
============================================
是否安装 NapcatQQ？(y/N): 
是否安装 1panle？-暂时无法使用，请选择不安装(y/N): 
是否安装 coplar？(y/N): 
```

### 步骤5: MoFox-Core配置
**需要用户输入的配置项较多，请参考上面的详细说明**

### 步骤6: 安装完成
```
============================================
安装完成
============================================

╔══════════════════════════════════════════════════════════╗
║                     安装完成总结                         ║
...
是否现在重启系统？(y/N): 
```

## 重要提示

1. **备份重要数据**: 在运行脚本前，请备份重要数据
2. **网络连接**: 确保稳定的网络连接
3. **充足资源**: 确保系统有足够的存储空间和内存
4. **耐心等待**: 安装过程可能需要较长时间，请耐心等待
5. **错误处理**: 如果安装失败，检查日志文件 `/var/log/armbian_install_*.log`

## 日志文件
- 位置: `/var/log/armbian_install_YYYYMMDD_HHMMSS.log`
- 内容: 所有安装操作的详细记录
- 用途: 故障排除和安装验证



## 技术支持
如果遇到问题，请：
1. 检查日志文件
2. 确保系统满足最低要求
3. 参考相关软件的官方文档
4. 通过以下方式联系脚本编辑人：微信： LoveELYSIA11__11  QQ:2271368097