# 模型配置常见问题 (FAQ)

本文档旨在帮助用户解决在配置和使用语言模型时遇到的常见问题。

## HTTP 状态码相关问题

当与模型API交互时，您可能会遇到各种HTTP状态码。以下是常见状态码的解释和解决方法。

### Q: 请求失败并返回 `401 Unauthorized` 状态码是什么原因？

**A:** 这是最常见的错误之一，表示 **API密钥（API Key）无效或缺失**。

*   **原因**:
    *   您没有在 `config/model_config.toml` 文件中正确配置API密钥。
    *   您的API密钥复制不完整或包含了多余的字符（如空格）。
    *   您使用的API密钥已被吊销或已过期。

*   **解决方案**:
    1.  打开 `config/model_config.toml` 文件。
    2.  找到您正在使用的模型提供商（例如 `openai`, `deepseek` 等）的配置部分。
    3.  仔细检查 `api_key` 字段，确保其值是您从提供商处获取的完整且正确的密钥。
    4.  确认您的账户状态正常，密钥未被禁用。

### Q: 请求失败并返回 `400`、`402` 或 `403` 状态码是什么原因？

**A:** 这些状态码通常与请求参数、账户状态或权限有关。

*   **`400 Bad Request` (参数不正确)**:
    *   **原因**: 您发送给API的请求体包含了无效或缺失的参数。这可能是由于模型不支持某些功能（如特定的`tool`或`response_format`）导致的。
    *   **解决方案**: 检查您的代码或配置，确保传递给模型的参数是符合API文档规范的。

*   **`402 Payment Required` (账号余额不足)**:
    *   **原因**: 您的模型API账户余额不足以支付本次请求的费用。
    *   **解决方案**: 请前往对应的API提供商网站为您的账户充值。

*   **`403 Forbidden` (需要实名或权限不足)**:
    *   **原因**:
        *   您的账户需要完成实名认证才能使用该模型。
        *   您的账户没有权限访问所请求的模型。
        *   在某些情况下，也可能是由于余额不足。
    *   **解决方案**: 登录API提供商的网站，根据提示完成实名认证或检查您的账户权限设置。

### Q: 请求失败并返回 `429 Too Many Requests` 状态码是什么原因？

**A:** 这表示 **您的请求过于频繁**，已超出API提供商的速率限制（Rate Limit）。

*   **原因**: 在短时间内发送了大量请求。每个API提供商对不同等级的账户都有不同的请求频率限制（例如，每分钟的请求数）。
*   **解决方案**:
    1.  程序会自动进行重试。在 `utils_model.py` 中，系统会默认等待一段时间（`retry_interval`）后再次尝试。
    2.  如果问题持续存在，请考虑降低您的请求频率，或升级您的API账户以获取更高的速率限制。

### Q: 请求失败并返回 `500` 或 `503` 状态码是什么原因？

**A:** 这些是 **服务器端错误**，表示问题出在API提供商的服务器上。

*   **`500 Internal Server Error` (服务器内部故障)**:
    *   **原因**: API服务器在处理您的请求时遇到了意外的内部问题。
*   **`503 Service Unavailable` (服务器负载过高)**:
    *   **原因**: API服务器当前负载过高，无法处理您的请求。

*   **解决方案**:
    1.  程序会自动进行重试。这通常是临时性问题，稍后重试即可解决。
    2.  如果长时间持续出现此问题，请检查API提供商的状态页面或社区，确认是否存在大范围的服务中断。

## 网络与连接问题

### Q: 日志中出现“连接异常 (Connection Exception)”是什么问题？

**A:** 这表示您的服务器 **无法与模型API服务器建立网络连接**。

*   **原因**:
    *   您的服务器网络连接不稳定或中断。
    *   API服务器地址（`base_url`）配置错误。
    *   防火墙或网络代理阻止了对API服务器的访问。
*   **解决方案**:
    1.  检查您的服务器网络是否正常，尝试 `ping` 或 `curl` API的 `base_url` 看是否能通。
    2.  核对 `config/model_config.toml` 中的 `base_url` 是否正确无误。
    3.  检查防火墙或代理设置，确保程序有权限访问外部网络。

### Q: 日志中出现“响应解析错误 (Response Parse Error)”是什么问题？

**A:** 这表示程序成功接收到了API服务器的响应，但在 **解析响应内容（通常是JSON格式）时失败了**。

*   **原因**:
    *   API返回了非预期的格式（例如，HTML错误页面而不是JSON）。
    *   API返回的JSON格式不正确或已损坏。
    *   网络传输过程中数据包损坏。
*   **解决方案**:
    1.  检查日志中记录的原始响应内容（`e.ext_info`），分析其结构是否符合预期。
    2.  这通常是API提供商的临时问题。如果频繁出现，可以向API提供商报告此问题。