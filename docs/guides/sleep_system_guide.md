# 睡眠系统介绍

睡眠系统是 MoFox_Bot 的核心功能之一，它为您的 AI 角色赋予了逼真的作息规律。本系统通过一个复杂的状态机来模拟角色的睡眠周期，使其在设定的时间内自动进入和退出睡眠状态。

## 功能概述

睡眠系统会根据您在配置文件中设定的时间表，以及角色当前的“睡眠压力”，来动态地调整其睡眠状态。这不仅增强了角色的真实感，还允许您在它“休息”时段进行维护或更新，而不会打扰到用户。

## 与其他系统的交互

睡眠系统并非孤立运行，它与以下系统紧密相连：

*   **计划系统**：睡眠系统会从计划系统中获取每日的日程安排，以确定理论上的睡眠和起床时间。
*   **唤醒系统**：唤醒系统负责计算角色的“睡眠压力”。睡眠压力是一个关键指标，它会影响角色入睡的意愿和睡眠的稳定性。当睡眠压力较低时，角色可能会延迟入睡或在夜间更容易失眠。

## 状态详解

睡眠系统包含以下几种状态：

*   **AWAKE (清醒)**：角色的常规活动状态。
*   **PREPARING_SLEEP (准备入睡)**：在进入睡眠状态之前的一个短暂过渡期。
*   **SLEEPING (正在睡觉)**：角色处于休眠中，不会响应大部分消息。
*   **INSOMNIA (失眠)**：在睡眠期间可能触发的短暂清醒状态。
*   **WOKEN_UP (被吵醒)**：当角色在睡眠中被强制唤醒时进入此状态。

## 配置选项

您可以在 `bot_config.toml` 文件中对睡眠系统进行详细配置。

```toml
[sleep_system]
# 是否启用睡眠系统
# true: 启用
# false: 禁用
enable = true

# 是否启用弹性睡眠
# 启用后，角色会根据当前的睡眠压力来决定是否延迟入睡。
enable_flexible_sleep = true

# 弹性睡眠压力阈值
# 当睡眠压力低于此值时，角色会考虑延迟入睡。
flexible_sleep_pressure_threshold = 60

# 最大睡眠延迟分钟数
# 角色当天总计可以延迟入睡的最大分钟数。
max_sleep_delay_minutes = 120

# 是否启用睡前通知
# 启用后，角色在准备入睡时会发送一条晚安消息。
enable_pre_sleep_notification = true

# 失眠触发延迟分钟数范围
# 角色入睡后，会在此范围内随机选择一个时间点来检查是否触发失眠。
insomnia_trigger_delay_minutes = [30, 90]

# 失眠持续分钟数范围
# 如果触发失眠，角色会在此范围内随机选择一个持续时间。
insomnia_duration_minutes = [10, 40]

# 随机失眠概率
# 即使睡眠压力正常，角色也有一定概率触发失眠。
random_insomnia_chance = 0.1

# 被吵醒后尝试重新入睡的延迟分钟数
# 当角色被吵醒后，会等待这段时间再尝试重新入睡。
re_sleep_delay_minutes = 10
```

## 实际应用示例

### 场景一：规律作息的乖宝宝

如果您希望您的角色严格遵守作息时间，可以将弹性睡眠关闭。

```toml
[sleep_system]
enable = true
enable_flexible_sleep = false```

### 场景二：喜欢熬夜的夜猫子

如果您希望您的角色经常熬夜，可以调高睡眠压力阈值和最大延迟时间。

```toml
[sleep_system]
enable = true
enable_flexible_sleep = true
flexible_sleep_pressure_threshold = 80
max_sleep_delay_minutes = 240