# WebUI 使用指南

本页介绍如何启动和使用 MoFox 的 WebUI（`MoFox-UI` 项目），通过图形化界面管理和监控 MoFox-Core。

## 1. WebUI 是什么？

WebUI 是一个基于浏览器的控制面板，主要提供：

- 仪表盘：总览运行状态、快速入口
- 配置中心：可视化编辑机器人配置、模型配置、Napcat 配置
- 日志查看：实时查看和过滤日志
- 插件市场：浏览并管理插件
- 主题与外观：切换暗色/亮色模式，自定义主题配色

## 2. 前置准备

在本地运行 WebUI 之前，请确认：

- 已安装 Node.js（推荐使用当前 LTS 版本）
- 已拉取本仓库，并能看到 `MoFox-UI` 目录

## 3. 安装依赖

在项目根目录中进入 WebUI 子项目：

```bash
cd MoFox-UI
npm install
```

首次使用只需要安装一次，后续更新代码时如依赖有变化再执行即可。

## 4. 启动 WebUI

### 4.1 完整模式：前端 + 后端一起启动（推荐）

此模式下会同时启动：

- 后端：`python/main.py`（通过 uvicorn 提供 `/api` 和 `/config` 接口）
- 前端：Vite 开发服务器（默认端口为 `11451`）

在 `MoFox-UI` 目录执行：

```bash
npm run start
```

启动成功后，浏览器会自动打开，或者你可以手动访问：

- `http://127.0.0.1:11451` （默认 WebUI 地址）

> 注意：如果端口被占用，请先关闭占用该端口的程序，然后重新运行命令。

### 4.2 仅前端开发模式

如果你已经单独启动了后端服务，只想运行前端来调试界面，可以：

```bash
# 在 MoFox-UI 目录
npm run dev
```

此时要求后端已经在 `http://127.0.0.1:8001` 上运行（默认配置），否则界面会提示无法连接后端。

你也可以只启动后端：

```bash
npm run backend
```

然后再运行 `npm run dev`。

### 4.3 Demo 模式：无需后端的演示模式

如果你只想预览界面、演示 UI，或者在没有后端环境的机器上查看效果，可以使用 Demo 模式：

```bash
npm run demo
```

特点：

- 不需要启动后端服务
- 使用内置的模拟数据展示配置、日志、状态等
- 适合前端开发、演示和快速体验

限制：

- 所有修改不会写回真实配置文件
- 日志和状态数据是静态的
- 无法与真实的 MoFox-Core 交互

> 更详细的 Demo 模式说明，见 `MoFox-UI/DEMO_MODE.md`。

## 5. 登录与访问令牌

WebUI 默认启用了简单的「访问令牌」登录机制：

1. 首次进入 WebUI 时，会看到一个登录界面，需要输入访问令牌。
2. 目前前端内置支持的令牌示例有：
   - `mofox-admin-token`
   - `lycoris`
3. 令牌会被转换为小写后校验，因此大小写不敏感。
4. 登录成功后，令牌会被保存到浏览器的 `localStorage` 中（键名为 `webui_token`），下次访问会自动登录。

> 提示：在生产环境中，你可以根据自己的需求扩展/替换登录逻辑，此处只是默认实现。

## 6. 界面结构与主要功能

成功登录后，你会看到带有侧边栏的主界面，主要区域包括：

- **仪表盘（Dashboard）**：
  - 展示 WebUI 启动状态、基础信息和常用入口
  - 对整体状态进行总览
- **配置中心（Config Center）**：
  - 分模块展示配置卡片，例如：数据库系统、机器人身份与权限、人格与对话逻辑、记忆系统、安全模块、内容生成、模型配置、Napcat 配置等
  - 修改后点击右下角的「保存」按钮即可一次性写回对应配置文件
- **日志查看（Logs）**：
  - 通过 WebSocket 实时读取日志文件
  - 可用于排查启动和运行问题
- **插件市场（Plugin Market）**：
  - 浏览插件仓库中的可用插件
  - 未来可扩展为一键安装/管理插件的入口
- **主题与外观（Theme）**：
  - 切换暗色 / 亮色模式
  - 自定义主题主色、辅色，并自动应用到界面

## 7. 常见问题

- **打不开页面 / 浏览器没有自动弹出？**
  - 请确认命令行中没有报错
  - 手动访问 `http://127.0.0.1:11451`

- **提示无法连接后端服务？**
  - 确认是否使用了 Demo 模式（`npm run demo`）
  - 如果是正常模式，请检查后端是否在 `8001` 端口运行，防火墙是否放行

- **登录总是失败？**
  - 确认令牌输入是否为上述示例之一，或是你在代码中自定义的合法令牌
  - 尝试清理浏览器缓存/本地存储后重新访问

如果你在使用 WebUI 的过程中遇到其它问题，欢迎在 GitHub Issue 中反馈。
